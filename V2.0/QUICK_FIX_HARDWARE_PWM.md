# URGENT: Hardware PWM Fix Required

## What's Wrong

Your test shows flickering during console logging because the system is using **SOFTWARE PWM** instead of **HARDWARE PWM**.

The default `gpiozero` setup uses the RPi.GPIO factory which generates PWM in software. This is affected by CPU load from console logging, causing the flickering you observed.

## The Fix (3 Steps)

### 1. Install pigpio daemon (5 minutes)

```bash
cd ~/Documents/RaspPI/V2.0
chmod +x setup_hardware_pwm.sh
./setup_hardware_pwm.sh
```

This installs and starts the pigpio daemon which provides true hardware PWM.

### 2. Configuration (Already Done ‚úÖ)

The config file has been updated:
```yaml
lighting:
  use_pigpio_factory: true  # Changed from false
```

### 3. Test It

```bash
python3 test_hardware_pwm.py
```

You should now see:
```
‚ö° Using gpiozero with PIGPIO FACTORY - Hardware PWM on GPIO 13/18 at 100Hz
‚ö° GPIO 13 using HARDWARE PWM via pigpio factory (flicker-free!)
‚ö° GPIO 18 using HARDWARE PWM via pigpio factory (flicker-free!)
```

And **ZERO flickering** during TEST 2 (heavy logging).

## Why This Fixes It

**Before** (RPi.GPIO factory):
- PWM generated by Python timing code
- Affected by any CPU activity
- Result: Flickering ‚ùå

**After** (pigpio factory):
- PWM generated by DMA hardware
- Completely independent of CPU
- Result: Zero flickering ‚úÖ

## Verification

After running the setup script:

```bash
# Check pigpio is running
pgrep -x pigpiod
# Should show a process ID

# Test hardware PWM
python3 test_hardware_pwm.py
# Should show ZERO flickering in TEST 2

# Run actual scan
python3 run_web_interface.py
# LEDs should be perfectly stable
```

## If You Still See Flickering

Check pigpio daemon:
```bash
sudo pigpiod
# Restart scanner application
```

See `HARDWARE_PWM_SETUP.md` for detailed troubleshooting.

## Summary

The flickering you observed proves we're using software PWM. The pigpio daemon is required for true hardware PWM on GPIO 13 and 18. Once installed, the flickering will completely disappear! üéâ
